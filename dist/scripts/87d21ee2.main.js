function createTranslation(a){var b=null;return function(c){return b||$.ajax("data/translations/messages-"+a+".json",{async:!1}).done(function(a){b=new Jed({locale_data:{messages:a}})}),b.gettext(c)}}var translate=createTranslation(window.location.hash.replace("#","").split("/")[0]||"en");window.Electionsbih={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";Electionsbih.router=new Electionsbih.Routers.BosniaElection,Backbone.history.start()}},$(document).ready(function(){"use strict";Electionsbih.init()}),this.JST=this.JST||{},this.JST["app/scripts/templates/election-select.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/language-select.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/map-markers.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/map.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/party-select.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/results-display.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/year-select.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p>Your content here.</p>\n\n";return __p},Electionsbih.Models=Electionsbih.Models||{},function(){"use strict";Electionsbih.Models.Results=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(){}})}(),Electionsbih.Collections=Electionsbih.Collections||{},function(){"use strict";Electionsbih.Collections.Results=Backbone.Collection.extend({urlRoot:"http://kdp-ztm.epf.p2.tiktalik.com:8090/v1/results/",model:Electionsbih.Models.Results,url:function(){return this.urlRoot+this.options.type+"/"+this.options.year},initialize:function(a){this.options=a},parse:function(a){return a.municipality_results}})}(),Electionsbih.Models=Electionsbih.Models||{},function(){"use strict";Electionsbih.Models.Mandates=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(){}})}(),Electionsbih.Collections=Electionsbih.Collections||{},function(){"use strict";Electionsbih.Collections.Mandates=Backbone.Collection.extend({urlRoot:"http://kdp-ztm.epf.p2.tiktalik.com:8090/v1/mandates/",model:Electionsbih.Models.Mandates,url:function(){return this.urlRoot+this.options.type+"/"+this.options.year},initialize:function(a){this.options=a},parse:function(a){return a.electoral_unit_mandates}})}(),Electionsbih.Routers=Electionsbih.Routers||{},function(){"use strict";function a(){Electionsbih.collections={mandates:new Electionsbih.Collections.Mandates({options:{year:"",type:""}}),results:new Electionsbih.Collections.Results({options:{year:"",type:""}})},Electionsbih.mapView=new Electionsbih.Views.Map({el:"#map",id:"map",map:Electionsbih.map,collection:Electionsbih.collections.results}),Electionsbih.markerView=new Electionsbih.Views.MapMarkers({el:"#map",id:"map",collection:{mandates:Electionsbih.collections.mandates,results:Electionsbih.collections.results}}),Electionsbih.resultsDisplay=new Electionsbih.Views.ResultsDisplay({collection:{mandates:Electionsbih.collections.mandates,results:Electionsbih.collections.results}}),Electionsbih.partySelect=new Electionsbih.Views.PartySelect({collection:Electionsbih.collections.mandates}),Electionsbih.yearSelect=new Electionsbih.Views.YearSelect({el:"#toggle-year",options:[d,f]}),Electionsbih.electionSelect=new Electionsbih.Views.ElectionSelect({el:"#toggle-election",options:[e,f]}),Electionsbih.languageSelect=new Electionsbih.Views.LanguageSelect({el:"#toggle-language",options:[c,f]}),$.getJSON("data/maps/bosnia.topojson",function(a){Electionsbih.topojson=a}),b=!0}var b=!1,c=[{display:"English",val:"en"},{display:"Bosnian",val:"bs"},{display:"Croatian",val:"hr"},{display:"Serbian",val:"sr"}],d=[{val:2010},{val:2014}],e=["parliament_bih","parliament_fbih","parliament_rs","kanton"],f={year:"",type:"",lang:""};L.mapbox.accessToken="pk.eyJ1IjoiZGV2c2VlZCIsImEiOiJnUi1mbkVvIn0.018aLhX0Mb0tdtaT2QNe2Q",Electionsbih.map=L.mapbox.map("map","devseed.31eaf6e2").setView([44,18],7),Electionsbih.Routers.BosniaElection=Backbone.Router.extend({routes:{"":"newload",":language/:year/:election":"newfilter"},newload:function(){f.year=2010,f.type="parliament_bih",f.lang="en",a(),Electionsbih.collections.results.options={year:f.year,type:f.type},Electionsbih.collections.results.fetch(),Electionsbih.collections.mandates.options={year:f.year,type:f.type},Electionsbih.collections.mandates.fetch(),this.navigate("en/2010/parliament_bih",{trigger:!1})},newfilter:function(g,h,i){_.contains(_.pluck(d,"val"),Number(h))&&_.contains(e,i)&&_.contains(_.pluck(c,"val"),g)?(this.navigate(g+"/"+h+"/"+i,{trigger:!1}),f.lang=g,f.year=h,f.type=i,b||a()):(this.navigate("en/2010/parliament_bih",{trigger:!1}),f.year=2010,f.type="parliament_bih",f.lang="en",b||a()),Electionsbih.electionSelect.render(),Electionsbih.yearSelect.render(),Electionsbih.collections.results.options={year:f.year,type:f.type},Electionsbih.collections.results.fetch(),Electionsbih.collections.mandates.options={year:f.year,type:f.type},Electionsbih.collections.mandates.fetch()},setLang:function(a){f.lang=a,translate=createTranslation(a),this.navigate(f.lang+"/"+f.year+"/"+f.type,{trigger:!0})}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.Map=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"sync",this.render),this.layers=[]},render:function(){this.layers.length&&_.each(this.layers,function(a){Electionsbih.map.removeLayer(a)}),Electionsbih.map.setView([44,18],7);var a,b=_.unique(_.flatten(_.map(this.collection.models,function(a){return _.pluck(a.get("electoral_units"),"id")}))),c=this,d=function(a,b){var c=String(a);return c.length<b?d("0"+a,b):c},e=_.map(b,function(a){return{electoral_unit:a,municipalities:_.map(_.pluck(_.filter(c.collection.models,function(b){return _.contains(_.pluck(b.get("electoral_units"),"id"),a)}),"id"),function(a){return d(a,3)})}});_.each(e,function(b){a=topojson.merge(Electionsbih.topojson,_.filter(Electionsbih.topojson.objects.bosnia.geometries,function(a){return _.contains(b.municipalities,a.id)}));var d=String(b.electoral_unit),e=L.geoJson(a,{style:function(){return{className:d,color:"#ccc",opacity:.7,fillColor:"#555",fillOpacity:.4,weight:1}}}).on({click:function(){c.layers.length&&_.each(c.layers,function(a){a.setStyle({color:"#ccc",weight:1})}),c.selected==this.options.style().className?(Electionsbih.map.setView([44,18],7),c.selected=0,Electionsbih.resultsDisplay.render("country"),Electionsbih.partySelect.render("country")):(this.setStyle({color:"#dc3",weight:3}),c.selected=this.options.style().className,Electionsbih.resultsDisplay.render(c.selected),Electionsbih.partySelect.render(c.selected)),Electionsbih.map.fitBounds(e.getBounds())}}).addTo(Electionsbih.map);c.layers.push(e)})}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.PartySelect=Backbone.View.extend({template:_.template($("#party-select-template").html()),tagName:"div",id:"party-select",el:"#party-select",className:"",events:{"click .party-select li":"partyToggle","click .sl-all":"selectAll","click .unsl-all":"unselectAll"},initialize:function(){this.listenTo(this.collection,"sync",function(){this.render()})},render:function(a){this.view=a||"country";var b,c,d=this;c="country"===this.view?this.collection.models:[_.find(this.collection.models,function(a){return a.get("electoral_unit_id")==d.view})],b=_.unique(_.flatten(_.map(c,function(a){return _.pluck(a.get("mandates"),"abbreviation")}))),this.$el.html(this.template({parties:b}))},partyToggle:function(a){$(a.target).toggleClass("active")},selectAll:function(){this.$(".party-select").children().toggleClass("active",!0)},unselectAll:function(){this.$(".party-select").children().toggleClass("active",!1)}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.ResultsDisplay=Backbone.View.extend({template:_.template($("#results-template").html()),tagName:"div",id:"results-display",el:"#results-display",initialize:function(){this.loaded=0,this.listenTo(this.collection.results,"sync",this.load),this.listenTo(this.collection.mandates,"sync",this.load)},render:function(a){this.view=a||"country",this.loaded=0;var b,c,d=this,e={},f=[];c="country"===this.view?this.collection.mandates.models:[_.find(this.collection.mandates.models,function(a){return a.get("electoral_unit_id")==d.view})],_.each(c,function(a){_.each(a.get("mandates"),function(a){e[a.abbreviation]?e[a.abbreviation].seats+=a.seats:e[a.abbreviation]={name:a.name,seats:a.seats,abbreviation:a.abbreviation}})}),"country"===this.view&&(b=_.find(c,function(a){return"00"===a.get("electoral_unit_id").toString().substring(1,3)}),b&&(f=b.get("mandates")),_.each(f,function(a){e[a.abbreviation].comp="("+String(a.seats)+")"})),e=_.sortBy(e,function(a){return-a.seats});var g,h={};_.each(this.collection.results.models,function(a){_.each(a.get("electoral_units"),function(a){_.each(a.results,function(b){("country"===d.view||d.view==a.id)&&(h[b.abbreviation]?h[b.abbreviation].votes+=b.votes:h[b.abbreviation]={name:b.name,abbreviation:b.abbreviation,votes:b.votes})})})}),g=_.reduce(h,function(a,b){return a+b.votes},0),_.each(h,function(a){a.per=(a.votes/g*100).toFixed(2)}),_.each(e,function(a){a.per=h[a.abbreviation].per}),this.$el.html(this.template({partySeats:e}))},load:function(){0==this.loaded?this.loaded+=1:this.render()}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.ElectionSelect=Backbone.View.extend({template:_.template($("#election-type-template").html()),id:"toggle-election",className:"",events:{},initialize:function(a){this.options=a.options[0],this.state=a.options[1],this.render()},render:function(){this.$el.html(this.template({navs:this.options,state:this.state}))}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.YearSelect=Backbone.View.extend({template:_.template($("#election-year-template").html()),id:"toggle-year",className:"",events:{},initialize:function(a){this.options=a.options[0],this.state=a.options[1],this.render()},render:function(){this.$el.html(this.template({navs:this.options,state:this.state}))}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.MapMarkers=Backbone.View.extend({initialize:function(){this.layers=[],this.loaded=0;var a=this;$.getJSON("data/maps/centroids.geojson",function(b){a.centroids=b}),this.listenTo(this.collection.results,"sync",this.load),this.listenTo(this.collection.mandates,"sync",this.load)},render:function(){this.layers.length&&_.each(this.layers,function(a){Electionsbih.map.removeLayer(a)});var a=function(b,c){var d=String(b);return d.length<c?a("0"+b,c):d},b=_.unique(_.flatten(_.map(this.collection.mandates.models,function(a){return _.pluck(a.get("mandates"),"abbreviation")}))),c=d3.scale.ordinal().domain(b).range(["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]),d=this.centroids,e=[];_.each(this.collection.results.models,function(b){var f=b.get("electoral_units")[0].results,g=_.sortBy(f,function(a){return-a.votes}),h=g.slice(0,3),i=_.find(d.features,function(c){return c.properties.id==a(b.get("id"),3)});if(i){var j=i.geometry.coordinates,k=(Electionsbih.map.getBounds()._northEast.lat-Electionsbih.map.getBounds()._southWest.lat)/200;_.each(h,function(a,b){e.push(L.circleMarker([j[1]+k*Math.sin(2*b*Math.PI/3),j[0]+k*Math.cos(2*b*Math.PI/3)],{radius:Math.sqrt(a.votes)/10,weight:1.5,color:c(a.abbreviation),opacity:.8,fillColor:c(a.abbreviation),fillOpacity:.8}))})}});var f=new L.LayerGroup(e).addTo(Electionsbih.map);this.layers.push(f)},load:function(){0==this.loaded?this.loaded+=1:this.render()}})}(),Electionsbih.Views=Electionsbih.Views||{},function(){"use strict";Electionsbih.Views.LanguageSelect=Backbone.View.extend({template:_.template($("#language-template").html()),events:{"click a":"select"},initialize:function(a){this.options=a.options[0],this.selected=_.find(this.options,function(b){return b.val==a.options[1].lang}).display,this.render()},render:function(){this.$el.html(this.template({options:this.options,selected:this.selected})),this.$selected=this.$(".selected"),this.$dropdown=this.$(".dropdown")},select:function(a){return a.preventDefault(),a=a.target,console.log(a),this.$selected.text(a.innerHTML),this.$dropdown.toggleClass("open"),Electionsbih.router.setLang(a.className),!1}})}();